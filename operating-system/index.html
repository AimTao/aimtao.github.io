<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="76x76" href="https://hutu0.aimtao.net/site/icon.webp"><link rel="icon" href="https://hutu0.aimtao.net/site/icon.webp"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="AimTao"><meta name="keywords" content="C++,Python,Go,算法，开发,blog,后端,记录"><meta name="description" content="本文系统描述操作系统的主要功能，重点在于全局的知识框架，而非细节。"><title>学习笔记｜操作系统 - AimTao</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_2113603_2ltiep6fmf8.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/lxgwwenkai-regular.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"www.aimtao.net",root:"/",version:"1.9.1",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"sh"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h2,h3,h4",collapseDepth:2},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!0,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:"07fe5d228ae82eadee00480515f9d64b",google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"hkFccy0TBvlTMrTD2n9MwSIx-gzGzoHsz",app_key:"yUJSgy6kcnRscdGX9ec7jlFz",server_url:"https://analytics.aimtao.net",path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><style type="text/css">.spoiler{display:inline}p.spoiler{display:flex}.spoiler a{pointer-events:none}.spoiler-blur,.spoiler-blur>*{transition:text-shadow .5s ease}.spoiler .spoiler-blur,.spoiler .spoiler-blur>*{color:transparent;background-color:rgba(0,0,0,0);text-shadow:0 0 10px grey;cursor:pointer}.spoiler .spoiler-blur:hover,.spoiler .spoiler-blur:hover>*{text-shadow:0 0 5px grey}.spoiler-box,.spoiler-box>*{transition:color .5s ease,background-color .5s ease}.spoiler .spoiler-box,.spoiler .spoiler-box>*{color:#000;background-color:#000;text-shadow:none}</style><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="AimTao" type="application/atom+xml">
</head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>AimTao&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> Home</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> Categories</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> Tags</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> About</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> Links</a></li><li class="nav-item"><a class="nav-link" href="/atom.xml"><i class="iconfont icon-rss"></i> RSS</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-archive-fill"></i> Archives</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/">Timeline </a><a class="dropdown-item" href="/categories/Implement-From-Scratch/">Implement From Scratch </a><a class="dropdown-item" href="/tags/Kernel/">Linux kernel </a><a class="dropdown-item" href="/categories/Mark/">Mark</a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://hutu.aimtao.net/web/2019-05-31-operating-system.webp-s) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="学习笔记｜操作系统"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2019-05-31 15:46" pubdate>2019-05-31 PM</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 14k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 11 mins</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">学习笔记｜操作系统</h1><p class="note note-info">本文最后更新于：5 years ago</p><div class="markdown-body"><blockquote><p>本文系统描述操作系统的主要功能，重点在于全局的知识框架，而非细节。</p></blockquote><span id="more"></span><h2 id="1-为什么需要操作系统">1.为什么需要操作系统</h2><h3 id="1-1-操作系统的演进">1.1 操作系统的演进</h3><h4 id="1-1-1-无操作系统">1.1.1 无操作系统</h4><ul><li>人工操作</li><li>用户独占一台计算机</li><li>CPU等待人工操作</li><li><strong>资源利用率低</strong></li></ul><h4 id="1-1-2-批处理系统">1.1.2 批处理系统</h4><ul><li><p>无需等待人工输入</p></li><li><p>批量输入任务</p></li><li><p><strong>资源利用率提升</strong></p></li><li><p><strong>多道程序设计</strong></p></li></ul><h4 id="1-1-3-分时系统">1.1.3 分时系统</h4><ul><li>人-机交互</li><li>多用户共享</li><li><strong>及时调试</strong></li></ul><h3 id="1-2-多道程序设计">1.2 多道程序设计</h3><h4 id="1-2-1-作用：">1.2.1 作用：</h4><ul><li>早期批处理系统只能一次处理一个任务。</li><li><strong>多道程序设计</strong>使得批处理系统可以一次处理多个任务。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-07-19-nWfY58.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="1-2-2-原理：">1.2.2 原理：</h4><ul><li>多道程序设计：计算机内存中同时存放多个程序。</li><li>多道程序在计算机的管理程序下互相穿插运行，以此提高计算机资源的利用率。</li></ul><h3 id="1-3-操作系统的功能">1.3 操作系统的功能</h3><blockquote><p><strong>操作系统的重要功能：对【多道程序】的管理。</strong></p></blockquote><p>对 <strong>多道程序</strong> 的管理分为五大功能：</p><p>进程管理、存储管理、作业管理、文件管理、设备管理。</p><h4 id="1-3-1-进程管理">1.3.1 进程管理</h4><ul><li>进程实体</li><li>五状态模型</li><li>进程同步</li><li>Linux 的进程管理</li></ul><h4 id="1-3-2-作业管理">1.3.2 作业管理</h4><ul><li>进程调度</li><li>死锁</li></ul><h4 id="1-3-3-存储管理">1.3.3 存储管理</h4><ul><li>内存分配与回收</li><li>段页式存储管理</li><li>虚拟内存</li><li>Linux 的存储管理</li></ul><h4 id="1-3-4-文件管理">1.3.4 文件管理</h4><ul><li>文件管理</li><li>Linux 的文件系统</li><li>Linux 文件的基本操作</li></ul><h4 id="1-3-5-设备管理">1.3.5 设备管理</h4><ul><li>设备管理</li></ul><h2 id="2操作系统的概览">2操作系统的概览</h2><h3 id="2-1-什么是操作系统">2.1 什么是操作系统</h3><p>管理硬件、提供用户交互的软件系统。</p><p>具体为：</p><ul><li>操作系统是管理计算机硬件资源和软件资源的计算机程序。</li><li>管理配置内存、决定资源供需顺序、控制输入输出设备等。</li><li>操作系统提供让用户和系统交互的操作界面。</li></ul><h3 id="2-2-操作系统的基本功能">2.2 操作系统的基本功能</h3><h4 id="2-2-1-统一管理计算机资源">2.2.1 统一管理计算机资源</h4><ul><li>处理器资源</li><li>IO设备资源</li><li>存储器资源</li><li>文件资源</li></ul><h4 id="2-2-2-实现对计算机资源的抽象">2.2.2 实现对计算机资源的抽象</h4><ul><li>无需面向硬件接口编程。</li><li>IO设备管理软件，提供读写接口。</li><li>文件管理软件，提供操作文件接口。</li></ul><h4 id="2-2-3-提供用户与计算机之间的接口">2.2.3 提供用户与计算机之间的接口</h4><ul><li>图形窗口的形式</li><li>命令形式</li><li>系统调用形式</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-08-29-BV2kaa.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="2-3-操作系统的相关概念">2.3 操作系统的相关概念</h3><h4 id="2-3-1-并发性">2.3.1 并发性</h4><ul><li>并行：两个或者多个事件在 <em><strong>同一时刻</strong></em> 发生。</li><li>并发：两个或者多个事件在 <em><strong>同一个时间间隔</strong></em> 发生。</li></ul><p>例如：</p><p>【并行】一边听课一边记笔记：听 和 记 同一个时刻发生。</p><p>【并发】先听课再记笔记：在同一个时间段完成两个事件。</p><p><img src="https://hutu.aimtao.net/mark/2020-08-29-i8399v.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li>单处理器只存在并发执行。</li><li>双处理器每个时刻都是有两个程序并行执行，既有并发也有并行。</li></ul><h4 id="2-3-2-共享性">2.3.2 共享性</h4><ul><li><p>共享性：操作系统中的资源可供多个并发的程序共同使用。</p></li><li><p>这种共同使用的形式称为：资源共享。</p></li></ul><p><strong>【资源共享】</strong>：</p><ul><li>多个程序同时使用主存资源。</li><li>资源共享分为：互斥共享形式、同时访问形式。<ul><li>互斥共享：当前资源被程序A占用，其他的想使用的话只能等待。</li><li>同时访问：某资源在一段时间内被 <strong><em>并发地</em></strong> 被多个程序访问。“同时” 是宏观的，宏观上看，该资源可以被同时访问。</li></ul></li></ul><p><img src="https://hutu.aimtao.net/mark/2020-08-29-g9kLiy.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p>举个例子：</p><ul><li>互斥共享形式：程序A 占用打印机，程序B 需要等待 程序A 使用完毕。</li><li>同时访问形式：程序A 和 程序B，同时访问主存的不同位置；或者 一段时间内，多个程序 <strong><em>并发地</em></strong> 访问某资源。</li></ul><h4 id="2-3-3-虚拟性">2.3.3 虚拟性</h4><ul><li>虚拟性：把一个物理实体转变为若干个逻辑实体。</li><li>物理实体是真实存在的，逻辑实体是虚拟的。</li><li>虚拟技术：时分复用技术、空分复用技术。</li></ul><p>【<strong>时分复用技术</strong>】</p><ul><li><p>资源在时间上进行复用：不同程序并发使用。</p></li><li><p>多道程序 <em><strong>分时使用</strong></em> 计算机硬件资源。</p></li><li><p>提高资源利用率。</p></li></ul><p><strong>（1）虚拟处理器技术</strong></p><ul><li>借助多道程序设计技术。</li><li>为每个程序建立进程。</li><li>多个程序分时复用处理器。</li></ul><p><strong>（2）虚拟设备技术</strong></p><ul><li>物理设备虚拟成多个逻辑设备。</li><li>每个程序占用一个逻辑设备。</li><li>多个程序通过逻辑设备并发访问。</li></ul><p>【<strong>空分复用技术</strong>】</p><ul><li>实现虚拟内存、虚拟磁盘。</li><li>提高资源的利用率，提升编程效率。</li></ul><p><strong>（1）虚拟磁盘技术</strong></p><ul><li>物理磁盘虚拟为逻辑盘。</li><li>C盘、D盘…等为逻辑盘。</li><li>更安全、方便地使用。</li></ul><p><strong>（2）虚拟内存技术</strong></p><ul><li>在逻辑上扩大了程序的存储容量。</li><li>便于使用比实际内存更大的容量。</li><li>提升编程的效率。</li></ul><h4 id="2-3-4-异步性">2.3.4 异步性</h4><ul><li>在多道程序的环境下，允许多个进程并发执行。</li><li>进程在使用资源时，可能需要等待或放弃。</li><li>进程的执行并不是一气呵成的，而是走走停停的形式推进的。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-08-29-CZib2H.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h2 id="3-进程管理">3.进程管理</h2><h3 id="3-1-进程实体">3.1 进程实体</h3><h4 id="3-1-1-为什么需要进程">3.1.1 为什么需要进程</h4><ul><li><p>进程是 系统进行 <em><strong>资源分配和调度</strong></em> 的基本单位</p></li><li><p>进程作为程序的独立运行的载体保障程序正常执行。</p><p>因为：进程在运行时会隔离并行资源。</p></li><li><p>进程存在使得操作系统资源的利用率大幅提升。</p></li></ul><h4 id="3-1-2-主存中的进程形态">3.1.2 主存中的进程形态</h4><blockquote><p>进程控制块（PCB）</p></blockquote><ul><li>进程控制块（PCB）：主存中的连续存储空间。</li><li>进程控制块的以下信息分为四类：<ul><li>进程的标识符</li><li>进程状态</li><li>进程调度信息</li><li>进程控制信息</li></ul></li></ul><table><thead><tr><th>信息</th><th>作用</th></tr></thead><tbody><tr><td>标识符（进程ID）</td><td>唯一标记一个进程，用于区别其他进程。</td></tr><tr><td>状态</td><td>标记进程的进程状态。</td></tr><tr><td>程序计数器</td><td>指向即将被执行的下一条指令的地址。</td></tr><tr><td>内存指针</td><td>程序代码、进程数据相关的指针。</td></tr><tr><td>上下文数据</td><td>进程指向时，处理器存储的数据。</td></tr><tr><td>IO状态信息</td><td>被进程IO操作所占用的文件列表。</td></tr><tr><td>记账信息</td><td>处理时间、时钟数总和。</td></tr></tbody></table><p><strong>（1）进程控制块（PCB）的作用</strong></p><ul><li>用于描述和控制进程运行的通用数据结构。</li><li>记录进程的当前状态和控制进程运行的全部信息。</li><li>PCB 使得进程是能够独立运行的基本单位。</li></ul><p><strong>（2）进程控制块（PCB）的位置</strong></p><ul><li>PCB 是操作系统进行调度时，经常会被读取的信息。</li><li>PCB 是常驻内存的，存在系统专门开辟的PCB区域。</li></ul><h3 id="3-2-进程与线程">3.2 进程与线程</h3><blockquote><p>进程：Process</p><p>线程：Thread</p></blockquote><ul><li>一个进程可以有多个线程。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-08-29-6QUmI2.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li>线程是操作系统进行运行调度的最小单位。</li><li>线程包含在进程中，是进程中实际运行工作的单位。</li><li>一个进程可以并发多个线程，每个线程执行不同的任务。</li></ul><table><thead><tr><th></th><th>进程</th><th>线程</th></tr></thead><tbody><tr><td>资源</td><td>资源分配的基本单位</td><td>不拥有资源</td></tr><tr><td>调度</td><td>独立调度的基本单位</td><td>独立调度的最小单位</td></tr><tr><td>系统开销</td><td>进程系统开销大</td><td>线程系统开销小</td></tr><tr><td>通信</td><td>进程IPC</td><td>读写同一进程的数据通信</td></tr></tbody></table><h3 id="3-3-五态模型">3.3 五态模型</h3><p><img src="https://hutu.aimtao.net/mark/2020-09-01-QKOZFt.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="3-3-1-就绪状态">3.3.1 就绪状态</h4><blockquote><p>有所有资源（进程控制块、内存、栈空间、堆空间），只差 CPU。</p></blockquote><ul><li>当进程被分配到除 CPU 以为所有必要的资源后，就是就绪状态。</li><li>只要获得 CPU 使用权，就可以立即执行。</li></ul><p><strong>【就绪队列】</strong>：</p><p>在一个系统中，多个就绪状态的进程通常排成一个队列：就绪队列。</p><h4 id="3-3-2-执行状态">3.3.2 执行状态</h4><ul><li>进程获得 CPU，其程序正在执行。</li><li>单处理机中，某一个时刻只有一个进程处于执行状态。（不存在并行执行）</li></ul><h4 id="3-3-3-阻塞状态">3.3.3 阻塞状态</h4><ul><li>进程因为某种状态，无法继续执行，从而放弃 CPU 的状态为阻塞状态。</li></ul><p><strong>【阻塞队列】</strong>：</p><ul><li>多个阻塞的进程，存放在队列里。</li></ul><h4 id="3-3-4-创建状态">3.3.4 创建状态</h4><ul><li>创建进程时，拥有 PCB，但 <em><strong>其他资源未就绪</strong></em> 的状态称为 <strong>创建状态</strong></li></ul><p><strong>【创建进程的两个步骤】</strong>：</p><pre><code class="mermaid">graph LR
A(1.分配 PCB ) --&gt; B(2.插入就绪队列)
</code></pre><p>PS：操作系统提供 fork 函数接口创建进程。</p><h4 id="3-3-5-终止状态">3.3.5 终止状态</h4><ul><li>进程结束由系统清理或者归还 PCB 的状态称为终止状态。</li></ul><p><strong>【终止状态的两个步骤】</strong>：</p><pre><code class="mermaid">graph LR
A(1.清理系统) --&gt; B(2.归还 PCB)
</code></pre><h4 id="3-3-6-状态转换的过程">3.3.6 状态转换的过程</h4><p>理解，默写一边。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-01-QKOZFt.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="3-4-进程同步">3.4 进程同步</h3><h4 id="3-4-1-生产者消费者问题">3.4.1 生产者消费者问题</h4><p><strong>（1）问题描述</strong></p><p><img src="https://hutu.aimtao.net/mark/2020-09-01-gO07md.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li>多个生产者进程生产产品，并放入缓冲区。</li><li>多个消费者进程从缓冲区取走这些产品消费。</li><li>生产者进程和消费者进程可以并发执行。</li><li>在两者之间有 n 个缓冲区的缓冲池。</li></ul><p><strong>（2）具体过程</strong></p><p>【<strong>生产者进程</strong>】生产一个产品，放到缓冲区（操作缓冲区数据），三个步骤：</p><ol><li><p><strong>register = count</strong></p><p>register 是生产者进程的寄存器。count 是缓冲区，缓冲在 Cache 上。先将缓冲区的 count 数据赋值给生产者进程寄存器 register。</p></li><li><p><strong>register = register + 1</strong></p><p>寄存器加一。</p></li><li><p><strong>count = register</strong></p><p>将生产者进程的寄存器 register 的数据，写入缓冲区 count。</p></li></ol><p>【<strong>消费者进程</strong>】消费一个产品，从缓冲区取走（操作缓冲区数据）， 三个步骤：</p><ol><li><p><strong>register = count</strong></p><p>register 是消费者进程的寄存器。count 是缓冲区。先将缓冲区的 count 数据赋值给消费者进程寄存器 register。</p></li><li><p><strong>register = register - 1</strong></p><p>寄存器减一。</p></li><li><p><strong>count = register</strong></p><p>将消费者进程寄存器 register 的数据，写入缓冲区 count。</p></li></ol><p><strong>（3）进程不同步会发生的问题</strong></p><p>因为生产者进程和消费者进程是并发执行的，而 count 是临界资源，所以会出现问题。</p><p>例如：</p><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cc"><span class="hljs-comment">// 假设 count = 10；</span><br>producer.<span class="hljs-keyword">register</span> = count;   <span class="hljs-comment">// count = 10,  p.register = 10</span><br>producer.<span class="hljs-keyword">register</span>++;         <span class="hljs-comment">// count = 10,  p.register = 11</span><br>comsumer.<span class="hljs-keyword">register</span> = count;   <span class="hljs-comment">// count = 10,  c.register = 10</span><br>comsumer.<span class="hljs-keyword">register</span>--;         <span class="hljs-comment">// count = 10,  c.register = 9</span><br>count = comsumer.<span class="hljs-keyword">register</span>;   <span class="hljs-comment">// count = 9,   c.register = 9</span><br>count = producter.<span class="hljs-keyword">register</span>;  <span class="hljs-comment">// count = 11,  p.register = 11</span><br></code></pre></td></tr></table></figure><p>出现问题：最终 count 应该是 10， 但是最后执行完还是 11。</p><h4 id="3-4-2-哲学家进餐问题">3.4.2 哲学家进餐问题</h4><p><strong>（1）问题描述</strong></p><ul><li>有五个哲学家，他们的生活方式是交替地进行思考和进餐，哲学家们共同使用一张圆桌，分别坐在周围的五张椅子上，在圆桌上有五个碗和五支筷子。</li><li>平时哲学家们只进行思考，饥饿时则 试图 取靠近他们的左、右两支筷子，只有两支筷子都被他拿到的时候就能进餐，进餐完毕之 后，放下 左右筷子继续思考。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-01-dHSys1.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="3-4-3-为什么需要进程同步">3.4.3 为什么需要进程同步</h4><p>从例子来分析：</p><ul><li>问题根源：彼此之间没有通信。</li><li>生产者消费者问题：生产者通知消费者，我已经生产一件产品了。</li><li>哲学家进餐问题：哲学家和旁边的哲学家说我要进餐了。</li></ul><p><strong>（1）进程同步的作用</strong>：</p><ul><li>对竞争资源在多进程间进行使用次序的协调。</li><li>使得并发执行的多个进程间，可以有效使用资源和互相合作。</li></ul><p><strong>（2）临界资源</strong>：</p><ul><li>临街资源指一些虽作为共享资源却又无法同时被多个线程共同访问的贡献资源。</li><li>当有进程使用临界资源时，其他进程必须依据操作系统的同步机制等待占用进程释放该资源，才可以重新竞争该资源。</li></ul><h4 id="3-4-4-进程同步的四个原则">3.4.4 进程同步的四个原则</h4><ul><li><p>空闲让进：资源未被占用，允许使用。</p></li><li><p>忙则等待：资源被占用，请求进程等待。</p></li><li><p>有限等待：保证有限的等待时间内，能够使用资源。</p></li><li><p>让权等待：等待时，进程需要让出 CPU，（执行状态 --&gt; 阻塞状态）。</p></li></ul><h4 id="3-4-5-进程同步的三个方法">3.4.5 进程同步的三个方法</h4><ul><li>消息队列</li><li>共享存储</li><li>信号量</li></ul><h4 id="3-4-6-线程同步">3.4.6 线程同步</h4><ul><li>进程的线程共享进程资源。</li><li>当多个线程并发使用进程资源时，也需要同步。</li></ul><h4 id="3-4-7-线程同步的四个方法">3.4.7 线程同步的四个方法</h4><ul><li>互斥量</li><li>读写锁</li><li>自旋锁</li><li>条件变量</li></ul><h3 id="3-5-Linux-的进程管理">3.5 Linux 的进程管理</h3><h4 id="3-5-1-进程的类型">3.5.1 进程的类型</h4><ul><li><strong>前台进程</strong>：具有终端，可以和用户交互的进程。</li><li><strong>后台进程</strong>：<ul><li>与前台进程相对，没有占用终端的就是后台进程。</li><li>后台程序基本不和用户交互，优先级比前台进程低。</li><li>PS：将需要执行的命令以 “&amp;“ 符号结束。</li></ul></li><li><strong>守护进程（daemon）</strong>：<ul><li>守护进程是特殊的后台进程。</li><li>很多守护进程在系统引导的时候启动，一直运行到系统关闭。</li><li>PS：进程以 ”d“ 结尾的一般都是守护进程。如：httpd，sshd，crond，mysqld…</li></ul></li></ul><h4 id="3-5-2-进程的标记">3.5.2 进程的标记</h4><p><strong>（1）进程的ID</strong></p><ul><li>进程 ID 是进程的唯一标记，每个进程拥有不同的 ID。</li><li>进程 ID 表现为一个非负整数，最大值由操作系统限定。</li><li><strong>top 命令查看所以进程。</strong></li></ul><p><strong>（2）进程的层级关系</strong></p><ul><li><strong>pstree 命令查看父子进程关系。</strong></li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-01-Wv60EC.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（3）特殊的进程</strong></p><ul><li>ID 为 0 的进程，idle 进程，是系统创建的第一个进程。</li><li>ID 为 1 的进程，init 进程，是 0 号进程的子进程，完成系统初始化。</li><li>init 进程是所有用户进程的祖先进程。</li></ul><h4 id="3-5-3-进程的状态标记">3.5.3 进程的状态标记</h4><table><thead><tr><th>状态符号</th><th>状态说明</th></tr></thead><tbody><tr><td>R</td><td>（TASK_RUNNING）运行状态</td></tr><tr><td>S</td><td>（TASK_INTERRUPTIBLE）睡眠状态</td></tr><tr><td>D</td><td>（TASK_UNINTERRUPTIBLE）等待 IO 的睡眠状态</td></tr><tr><td>T</td><td>（TASK_STOPPED）暂停状态</td></tr><tr><td>Z</td><td>（TASK_DEAD or EXIT_ZOMBIE）退出状态 或 僵尸进程</td></tr></tbody></table><h4 id="3-5-4-操作进程的命令">3.5.4 操作进程的命令</h4><p><strong>（1）ps 命令</strong></p><p>显示当前进程状态。</p><p><strong>-aux</strong>：打印进程的详细信息：进程用户、进程 ID、进程状态、运行时间、执行的命令…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 查看 root 用户的进程</span><br>ps -u root<br><br><span class="hljs-comment"># 查询 pyhton3 的进程</span><br>ps -aux | grep <span class="hljs-string">&#x27;python3&#x27;</span><br><br><span class="hljs-comment"># 打印进程的父子关系</span><br>ps -ef --forest   <span class="hljs-comment"># forest：森林</span><br><br><span class="hljs-comment"># 按照 cpu 的使用排序（从大到小）</span><br>ps -aux --<span class="hljs-built_in">sort</span>=-pcpu<br><br><span class="hljs-comment"># 按照 内存 的使用排序（从大到小）</span><br>ps -aux --<span class="hljs-built_in">sort</span>=-pmem<br></code></pre></td></tr></table></figure><p><strong>（2）top 命令</strong></p><p>查看系统所有进程。</p><p>PR：优先级。VIRT：进程的虚拟内存。</p><p>total：所有的内存。free：所有的内存。used：已经使用的内存。buff：已经缓存的内存。</p><p><strong>（3）kill 命令</strong></p><p>发送指定信号给进程。</p><p>9 表示 无条件停止。sigkill。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">杀死 PID 是 62016 的进程。<br><span class="hljs-built_in">kill</span> -9 62016<br></code></pre></td></tr></table></figure><h2 id="4-作业管理">4.作业管理</h2><h3 id="4-1-进程调度">4.1 进程调度</h3><h4 id="4-1-1-进程调度">4.1.1 进程调度</h4><p><strong>进程调度</strong>：计算机通过决策决定哪个就绪进程可以获得 CPU 使用权。</p><ul><li>保留旧进程的运行信息，请出旧进程（收拾包袱）</li><li>选择新进程，准备运行环境并分配 CPU（新进驻）</li></ul><h4 id="4-1-2-进程调度的三种机制">4.1.2 进程调度的三种机制</h4><p><strong>（1）就绪队列的排队机制</strong></p><p>将就绪进程按照一定的方式排成队列，以便调度程序可以最快找到就绪进程。</p><p><strong>（2）选择运行进程的委派机制</strong></p><p>调度程序以一定的策略选择就绪进程，将 CPU 资源分配给它。</p><p><strong>（3）新老进程的上下文切换机制</strong></p><blockquote><p>进程或线程的上下文切换需要消耗 CPU。</p></blockquote><p>保存当前进程的上下文信息，装入被委派执行进程上下文。</p><ol><li><p>将老进程的上下文从 cache 存入主存当中，以便下次继续执行。</p><ol start="2"><li>将新进程的上下文存入 cache，让 CPU 准备运行环境。</li></ol></li></ol><p><img src="https://hutu.aimtao.net/mark/2020-09-03-MfGG4G.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="4-1-3-进程调度的两种方法">4.1.3 进程调度的两种方法</h4><p><strong>（1）非抢占式调度</strong></p><ul><li>处理器一旦分配给某一个进程，就让该进程一直执行下去。</li><li>调度程序不以任何原因抢占正在被使用的处理器。</li><li>直到进程完成工作或者因为 IO 阻塞才会让出处理器。</li><li></li></ul><p><strong>（2）抢占式调度</strong></p><ul><li>允许调度程序以一定的策略暂停当前运行的进程。</li><li>保留旧进程的上下文信息，分配处理器给新进程。</li></ul><p><strong>（3）比较</strong></p><table><thead><tr><th></th><th>抢占式调度</th><th>非抢占式调度</th></tr></thead><tbody><tr><td>系统开销</td><td>频繁切换、开销大</td><td>切换次数少、开销小</td></tr><tr><td>公平性</td><td>相对公平</td><td>不公平（一个进程可以长期占有 CPU）</td></tr><tr><td>应用</td><td>通用系统（计算机）</td><td>专用系统</td></tr></tbody></table><h3 id="4-2-调度算法">4.2 调度算法</h3><h4 id="4-2-1-先来先服务FCFS">4.2.1 先来先服务FCFS</h4><ul><li><p>非抢占式调度。</p></li><li><p>调度顺序为就绪队列的顺序。</p></li></ul><h4 id="4-2-2-短进程优先（最短作业优先SJF）">4.2.2 短进程优先（最短作业优先SJF）</h4><ul><li>调度程序优先选择就绪队列中估计运行时间最短的进程。</li><li>短进程优先调度算法不利于长作业进程的执行。</li></ul><p>PS：</p><ul><li>分为抢占式 SJF、非抢占式SJF。</li></ul><h4 id="4-2-3-高优先权优先">4.2.3 高优先权优先</h4><ul><li>进程附带优先权，调度程序优先选择权重高的进程。</li><li>高优先权优先调度算法使得 <em><strong>紧迫的任务</strong></em> 可以优先处理。<ul><li>前台进程优先级会高于后台进程，因为前台进程需要和用户交互，保证不卡顿。</li></ul></li></ul><p>PS：</p><ul><li>优先权太低的进程得不到运行，出现“饥饿”现象。</li><li>SJF 是 <em><strong>高优先权优先</strong></em> 的特例。</li></ul><h4 id="4-2-4-时间片轮转Round-Robin">4.2.4 时间片轮转Round-Robin</h4><ol><li>按照先来先服务的原则排列就绪进程。</li><li>每次从队列头部取出待执行的进程，分配一个时间片执行。</li><li>执行完时间片插入就绪队列尾部。</li></ol><p>PS：</p><ul><li>相对公平的调度算法，但不能保证及时响应用户。</li><li>当时间片足够长，就变成了 非抢占式调度，也就退化成 FCFS，FCFS 是 RR 的特例。</li></ul><h3 id="4-3-死锁">4.3 死锁</h3><h4 id="4-3-1-死锁的产生">4.3.1 死锁的产生</h4><p><strong>（1）竞争临界资源</strong></p><p>自身占用的资源不释放，等待请求的资源被释放。（哲学家进餐问题）</p><p><strong>（2）进程调度顺序不当</strong></p><p><img src="https://hutu.aimtao.net/mark/2020-09-03-rVVNGz.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p>进程1 和 进程2 都需要传真机和打印机才能执行，</p><ul><li><p>A --&gt; B --&gt; C --&gt; D 则产生死锁。</p></li><li><p>A --&gt; D --&gt; B --&gt; C 则不会产生死锁。</p></li></ul><h4 id="4-3-2-死锁的四个条件">4.3.2 死锁的四个条件</h4><blockquote><p>四个必要条件。</p></blockquote><p><strong>（1）互斥条件</strong></p><ul><li>进程对资源的使用是排他性的使用。</li><li>资源只能由一个进程使用，其他进程使用只能等待。</li></ul><p><strong>（2）请求保持条件</strong></p><ul><li>进程至少保持一个资源，又提出新的资源的请求。</li><li>新的资源被其他进程占用，新的资源的请求被阻塞。</li><li>被阻塞的进程不释放自己的资源。</li></ul><p><strong>（3）不可剥夺条件</strong></p><ul><li>进程获得资源，在进程未完成使用前，资源不能被剥夺。</li><li>获得的资源只能由进程自身释放。</li></ul><p><strong>（4）环路等待条件</strong></p><ul><li>发生死锁，必然存在 <em><strong>进程-资源环形链</strong></em> （进程 P1、P2、P3、P4；资源R1、R2、R3、R4）</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-03-3EkPJY.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="4-3-3-预防死锁的方法">4.3.3 预防死锁的方法</h4><p><strong>（1）破坏请求保持条件</strong></p><ul><li>系统规定进程运行前，一次性申请所有需要的资源。</li><li>进程运行时，不会因为请求资源而产生等待的情况。</li></ul><p><strong>（2）破坏不可剥夺条件</strong></p><ul><li>进程请求新的资源得不到满足时，必须释放占有的资源。</li><li>进程运行时，占有的资源可以被释放，意味着可以被剥夺。</li></ul><p><strong>（3）破坏环路等待条件</strong></p><ul><li>可用资源线性排序，申请必须按照需要递增申请。</li><li>线性申请不再形成环路，从而破坏了环路等待条件。<ul><li>正例：线程A、B申请资源顺序均为R1-&gt;R2；</li><li>反例：A申请顺序为R1-&gt;R2，B申请顺序为R2-&gt;R1。</li></ul></li></ul><h4 id="4-3-4-银行家算法">4.3.4 银行家算法</h4><blockquote><p>是一个可操作的著名的避免死锁的算法。</p></blockquote><ul><li>客户申请的贷款是有限的，每次申请需声明最大资金量。</li><li>银行家在能够满足贷款时，给用户贷款。</li><li>客户使用贷款后，能及时归还贷款。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-03-TRoOgQ.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ol><li><strong>所需资源表</strong> - <strong>已分配资源表</strong> = <strong>还需分配资源表</strong>。</li><li>将 <strong>可分配资源表</strong> 和 <strong>还需分配资源表</strong> 进行对比。</li></ol><h2 id="5-存储管理">5.存储管理</h2><h3 id="5-1-内存分配和回收">5.1 内存分配和回收</h3><h4 id="5-1-1-为什么需要存储管理">5.1.1 为什么需要存储管理</h4><p>早期的计算机编程并不需要太多的储存管理。</p><p>随着计算机和程序越来越复杂，存储管理成为必要。</p><h4 id="5-1-2-三点原因">5.1.2 三点原因</h4><ul><li>确保计算机有足够的内存处理数据。</li><li>确保程序可以从可用内存中获取一部分内存使用。</li><li>确保程序可以归还使用后的内存，以供其他程序使用。</li></ul><h3 id="5-2-内存分配的过程">5.2 内存分配的过程</h3><h4 id="5-2-1-单一连续分配（过时）">5.2.1 单一连续分配（过时）</h4><blockquote><p>系统区内存给操作系统使用，用户区内存给用户程序使用。</p></blockquote><ul><li>单一连续分配是简单的内存分配方式。</li><li>只能在单用户、单进程的操作系统中使用。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-09-YnC9pF.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="5-2-2-固定分区分配">5.2.2 固定分区分配</h4><ul><li>固定分区分配是 <strong>支持多道程序的最简单</strong> 的存储分配方式。</li><li>内存空间被划分若干个固定大小的区域。</li><li>每个分区只提供给一个程序使用，互不干扰。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-09-QgUCKP.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="5-2-3-动态分区分配">5.2.3 动态分区分配</h4><p><strong>数据结构</strong>：</p><p><strong>（1）动态分区空闲表结构</strong></p><p><img src="https://hutu.aimtao.net/mark/2020-09-10-scwjWz.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><a name="内存空闲链表"><strong>（2）动态分区空闲链表结构</strong></a></p><p><img src="https://hutu.aimtao.net/mark/2020-09-10-sLddJ3.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><a name="分配算法"><strong>算法</strong>：</a></p><p><strong>（1）首次适应算法（FF算法）</strong></p><ul><li>分配内存时，从开始顺序查找合适内存区。</li><li>若没有合适的空闲区，则该次分配失败。</li><li><strong>问题</strong>：每次从头部开始，使得头部的地址空间不断的被划分（很多内存碎片）。每次都需要遍历到尾部的时候，才能分配到内存。</li><li><strong>改进</strong>：循环适应算法</li></ul><p><strong>（2）循环适应算法</strong></p><p>分配内存时，从上一次检索结束的位置开始。</p><p><strong>（3）最佳适应算法（BF算法）</strong></p><ul><li>先把空闲区链表按照容量大小排序。</li><li>遍历空闲区链表找到合适的空闲区。</li><li>好处：从小到大遍历，可以避免大才小用。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-10-ct7ljS.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（4）快速适应算法（QF算法）</strong></p><ul><li>有多个空闲链表</li><li>每个空闲链表存储一种容量的空闲区</li><li>当需要内存分配的时候，可以快速找到合适大小的空闲区。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-10-TprXTt.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="5-3-内存回收的过程">5.3 内存回收的过程</h3><p>四种情况：</p><p><img src="https://hutu.aimtao.net/mark/2020-09-10-Gs3hmd.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（1）回收区位于空闲区后</strong></p><ul><li><p>不需要建立新的空闲区节点。</p></li><li><p>将空闲区1的节点的容量增大为新的空闲区。</p></li></ul><p><strong>（2）回收区位于空闲区前</strong></p><ul><li>将回收区和空闲区1合并。</li><li>新的空闲区使用回收区的地址，作为新空闲区节点的地址。</li></ul><p><strong>（3）回收区位于两个空闲区之间</strong></p><ul><li>将空闲区1、空闲区2、回收区合并。</li><li>新的空闲区使用空闲区1的地址，作为新空闲区节点的地址。</li></ul><p><strong>（4）单独的回收区</strong></p><ul><li>为回收区创建新的空闲节点。</li><li>将空闲区节点插入空闲链表中。</li></ul><h3 id="5-4-段页式存储管理">5.4 段页式存储管理</h3><blockquote><p>从进程的角度管理内存空间。</p></blockquote><h4 id="5-4-1-页式存储管理">5.4.1 页式存储管理</h4><p><strong>（1）页面</strong></p><p><strong>页面</strong>：相对逻辑设备的定义。</p><p>字、字块：相对物理设备的定义。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-10-guaaO1.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（2）页式存储管理</strong></p><ul><li>将进程的逻辑空间等分成若干个大小的页面。</li><li>相应的把物理内存空间分成和页面大小相同的物理块。</li><li>以页面为单位，把进程空间装进物理内存中分散的物理块。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-10-23UT6d.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li>页面大小应该适中，过大难以分配，过小内存碎片过多。</li><li>页面大小通常是512B～8K</li></ul><p><strong>（3）页表</strong></p><ul><li>页表记录进程逻辑空间与物理空间的映射。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-10-ZOTTaD.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（4）页式存储的问题</strong></p><p>现代计算机系统中，可以支持非常大的逻辑地址空间（2^32 ～ 2^64）,页表就变得特别大（占用内存）。</p><p>举个例子：</p><ul><li>32位系统进程寻址空间为 4G，页面大小为 4KB，</li><li>那么就需要 4G / 4KB = 2^20 个页表。</li><li>一个页表大小为 1Byte，故每个进程需要 1MB 的内存存储页表。</li></ul><p><strong>（5）多级页表</strong></p><blockquote><p>为了解决上面页表过多占用内存的问题。</p></blockquote><ul><li>根页表的每个页面代表的是一个页表，字块指向一个二级页表的地址。</li><li>进程执行时，只需要将根页表加载到内存中，再按需取页表。（当用某个二级页表时，再把某个二级页笔加载到内存中。）</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-10-U04wdP.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（6）页式存储不可改进的问题</strong></p><p>若有一段连续的逻辑分布在多个页面中，将大大降低执行效率。</p><h4 id="5-4-2-段式存储管理">5.4.2 段式存储管理</h4><blockquote><p>改进页式存储不可改进的问题。</p></blockquote><ul><li>将进程逻辑空间划分为若干段（非等分）。</li><li>段的长度由 <strong>连续逻辑的长度</strong> 决定。</li><li>按照函数的逻辑长度划分，比如主函数 main，子程序段 x，子函数 y等。</li><li>拥有一个段表：</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-12-RsoqOw.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="5-4-3-段式存储和页式存储的区别">5.4.3 段式存储和页式存储的区别</h4><p><strong>共同点</strong>：离散地管理了进程的逻辑空间。</p><p><strong>不同点</strong>：</p><ul><li>页是物理单位，按照物理的角度划分的；段是逻辑单位，按照进程的逻辑划分的。</li><li>分页是为了合理利用空间，分段是满足用户的需求。</li><li>页大小由硬件固定，段长度可动态变化。</li><li>页表信息是一维（页号对应页号），段表信息是二维的（记录基址和段长）。</li></ul><h4 id="5-4-4-段页式存储管理">5.4.4 段页式存储管理</h4><ul><li><p>采取了页式存储和段式存储的优点。</p><ul><li>分页可以有效提高内存利用率。</li><li>分段可以更好地满足用户需求。</li><li>两者结合，形成段页式存储管理。</li></ul></li><li><p>先将逻辑空间按照段式管理分为若干段。</p></li><li><p>再把段内空间按页式管理分为若干页。</p></li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-12-IVU8Qe.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><img src="https://hutu.aimtao.net/mark/2020-09-12-d03HmO.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="5-5-虚拟内存">5.5 虚拟内存</h3><h4 id="5-5-1-为什么需要虚拟内存">5.5.1 为什么需要虚拟内存</h4><ul><li>有些进程实际需要的内存很大，超过物理内存的容量。</li><li>因为使用多道程序设计，所以计算机中同时运行着多个进程，使得每个进程的可用物理内存更加稀缺。</li><li>不可能无限增加物理内存，物理内存总有不够的时候。</li></ul><h4 id="5-5-2-虚拟内存概述">5.5.2 虚拟内存概述</h4><ul><li>虚拟内存是操作系统内存管理的关键技术。</li><li>使得多道程序运行和大程序运行成为现实。</li><li>把程序使用内存划分，将部分暂时不使用的内存放置在辅存中。</li></ul><p>如图，逻辑空间是程序运行所需的内存，将需要使用的加载到物理内存运行中，不使用的放置在缓存中。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-12-PGPqQt.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="5-5-3-程序的局部性原理">5.5.3 程序的局部性原理</h4><blockquote><p>补充：</p><p><strong>时间局部性</strong>：被引用过一次的存储器位置在未来会被多次引用（通常在循环中）。</p><p><strong>空间局部性</strong>：如果一个存储器的位置被引用，那么将来他附近的位置也会被引用。</p></blockquote><p>局部性原理是指 CPU 访问存储器时，无论是存取指令还是存取数据，所访问的存储单元都聚集在一个较小的连续区域中。</p><ul><li>程序运行时，无需全部装入内存，装载部分即可。</li><li>如果访问页不在内存中，则发出缺页中断，发起页面置换。</li><li>从用户层面看，程序拥有很大空间，即是虚拟内存。</li></ul><p><strong>虚拟内存实际上是对物理内存的 补充，速度接近于内存，成本接近于辅存。</strong></p><h4 id="5-5-4-虚拟内存的置换算法">5.5.4 虚拟内存的置换算法</h4><blockquote><p><strong>高速缓存和主存</strong> 置换、<strong>主存和辅存</strong> 置换都会使用到的算法。</p><p><strong>虚拟内存</strong> 的置换算法是 <strong>主存和辅存</strong> 的置换。</p></blockquote><ul><li>先进先出算法（FIFO）</li><li>最不经常使用算法（LFU）</li><li>最近最少使用算法（LRU）</li></ul><p><strong>（1）高速缓存的替换时机（高速缓存和主存的置换）</strong></p><p><img src="https://hutu.aimtao.net/mark/2020-09-12-tRSWNz.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（2）主存的替换时机（主存和辅存的置换）</strong></p><p><img src="https://hutu.aimtao.net/mark/2020-09-12-gYa2yv.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（3）高速缓存替换、主存替换的区别</strong></p><ul><li>替换策略发生在 Cache-主存层次、主存-辅存层次。</li><li><strong>Cache-主存层次</strong> 的替换策略主要为了 <strong>解决速度问题</strong>。</li><li><strong>主存-辅存层次</strong> 的替换主要为了 <strong>解决容量问题</strong>。</li></ul><h3 id="5-6-Linux-的内存管理">5.6 Linux 的内存管理</h3><h4 id="5-6-1-Buddy-内存管理算法">5.6.1 Buddy 内存管理算法</h4><ul><li>Buddy 算法是经典的内存管理算法。</li><li>算法基于 <strong>计算机处理二进制具有极高的效率</strong> 的优势。</li><li>算法主要是为了解决 <strong>内存外碎片</strong> 的问题。<ul><li>将 <strong>内存内碎片问题</strong> 转移成 <strong>内存外碎片问题</strong>。</li><li>为什么要转移？——内存外碎片一般比内存内碎片要大。</li></ul></li></ul><h4 id="5-6-2-页内碎片与页外碎片">5.6.2 页内碎片与页外碎片</h4><p><strong>页内碎片（内存内碎片、内部碎片）</strong>：</p><p>内部碎片是已经被分配出去（明确指出属于哪个进程）的内存空间，大于所需空间。</p><p>已分配的内存空间中不能被利用的内存空间就是内部碎片。</p><p><strong>页外碎片（内存外碎片、外部碎片）</strong>：</p><p>外部碎片是指还没分配出去（不属于任何进程），但是由于太小而无法分配给申请内存空间的新进程的内存空闲块。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-12-KIjKby.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="5-6-3-Buddy-内存分配原则">5.6.3 Buddy 内存分配原则</h4><blockquote><p>原因：计算机处理二进制具有极高的效率。</p></blockquote><ul><li>向上取整为 2 的幂的大小。<ul><li>如需 70K，则分配 128K</li><li>如需 129K，则分配 256K</li></ul></li></ul><h4 id="5-6-4-伙伴系统">5.6.4 伙伴系统</h4><ul><li>伙伴是指一片内存的伙伴。</li><li><strong>一片连续内存</strong> 的伙伴是指 <strong>相邻的另一片大小一样</strong> 的连续内存。</li></ul><h4 id="5-6-5-Buddy算法的具体流程">5.6.5 Buddy算法的具体流程</h4><ul><li>创建一系列的空闲块链表，每一种都是 2 的幂。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-12-STAeSn.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（1）分配内存</strong></p><blockquote><p>举个例子：</p></blockquote><ul><li>假设存储空间有 1M 的大小。</li><li>其他大小的空闲块链表节点都是空的，1MB的空闲块链表有一个节点。</li></ul><p>此时需要分配 100K 的内存，步骤如下：</p><ol><li>100K 向上取 2 的幂 = 128K。</li><li>查询是否有 128K 内存空闲块？——没有！</li><li>查询是否有 256K 内存空闲块？——没有！</li><li>查询是否有 512K 内存空闲块？——没有！</li><li>查询是否有 1M 内存空闲块？——有！</li><li>将 1M 内存空闲块分配出去。</li><li>将 1M 中的 512K 放在 512K 的空闲链表中，其余的分配出去。判断是否符合要求。</li><li>将 分配出去的 512K 中的 256K 放在 256K 的空闲链表中，其余的分配出去。判断是否符合要求。</li><li>将 分配出去的 256K 中的 128K 放在 128K 的空闲链表中，其余的分配出去。判断是否符合要求。</li><li>满足需求，分配完毕。</li></ol><p><strong>（2）回收内存</strong></p><blockquote><p>还是上面的例子：</p></blockquote><p>回收 128K 的内存步骤：</p><blockquote><p>伙伴：<strong>一片连续内存</strong> 的伙伴是指 <strong>相邻的另一片大小一样</strong> 的连续内存。</p></blockquote><ol><li>判断回收的内存的伙伴是否在 128K 的内存空闲链表上？——在！</li><li>移除伙伴，需回收的内存和伙伴合并为 256K 的空闲内存。判断其伙伴在不在 256K 的链表上？——在！</li><li>移除伙伴，合并的 256K 的内存和伙伴合并为 512K 的空闲内存。判断其伙伴在不在 512K 的链表上？——在！</li><li>移除伙伴，合并的 512K 的内存和伙伴合并为 1M 的空闲内存。判断其伙伴在不在 1M 的链表上？——不在！</li><li>将合并的 1M 的空闲块内存插入到 1M 的空闲链表中，回收完成。</li></ol><h4 id="5-6-6-Linux-交换空间（Swap）">5.6.6 Linux 交换空间（Swap）</h4><ul><li>交换空间（Swap）是磁盘的一个分区。</li><li>Linux 物理内存满时，会把一些内存交换至 Swap 空间。</li><li>Swap 空间是初始化系统时配置的。</li></ul><p>不推荐使用的原因：Swap 交换空间在磁盘，速度相对慢，如果频繁使用，降低系统运行速度。</p><p>作用：</p><ul><li><p>冷启动的内存依赖。——一些大型程序启动的时候需要大量的内存，但后续运行的时候，大部分内存会被很少地使用。系统就可以将这部分不怎么使用的数据，保存到 Swap 空间，从而释放更多的物理内存，供其他程序使用。</p></li><li><p>系统睡眠依赖。——当系统需要睡眠的时候，系统将所有内存数据保存在 Swap 空间中，等下次系统启动的时候，将这部分数据重新加载到内存中，提高系统的启动速度。</p></li><li><p>大进程的空间依赖。——某些大进程的确需要很大的内存空间。将进程需要使用到的数据暂时保存到 Swap 空间中。</p></li></ul><h4 id="5-6-7-虚拟内存和-Swap-空间的区别">5.6.7 虚拟内存和 Swap 空间的区别</h4><p><strong>相同点</strong>：</p><ul><li>都是存在于磁盘（辅存）中。</li><li>都是与主存发生置换。</li></ul><p><strong>不同点</strong>：</p><ul><li>Swap 空间是操作系统的概念。<ul><li>站在 Linux 的角度去看待的。</li></ul></li><li>虚拟内存是进程概念。<ul><li>站在 进程 的角度去看待的。</li><li>当我们谈到虚拟内存的时候，是指 某个进程 的虚拟内存。</li></ul></li><li>Swap 空间是为了解决系统物理内存不足的问题。</li><li>虚拟内存是为了解决进程物理内存不足的问题。</li></ul><h2 id="6-文件管理">6.文件管理</h2><h3 id="6-1-文件的逻辑结构">6.1 文件的逻辑结构</h3><h4 id="6-1-1-文件的结构类型">6.1.1 文件的结构类型</h4><p><img src="https://hutu.aimtao.net/mark/2020-09-13-s9bWxW.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="6-1-2-有结构文件">6.1.2 有结构文件</h4><ul><li>文件内容由 <strong>定长记录</strong> 和 <strong>可变长记录</strong> 组成。</li><li><strong>定长记录</strong> 存储文件格式、文件描述等结构化数据项。</li><li><strong>可变长记录</strong> 存储文件具体内容。</li></ul><p><strong>举个例子—— 以 png 图片的文件格式为例</strong>：</p><ul><li>定长记录存储文件格式、文件描述等结构化数据项：PNG文件标记、文件结束标记。</li><li>可变长记录存储文件具体内容：PNG数据块。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-13-5mWLIF.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="6-1-3-无结构文件（流式文件）">6.1.3 无结构文件（流式文件）</h4><ul><li>文件内容长度以字节为单位。</li><li>如exe文件、dll文件、so文件。</li></ul><h4 id="6-1-4-顺序文件">6.1.4 顺序文件</h4><ul><li>顺序文件指 按顺序存放在存储介质中的文件。</li><li>磁带的存储特性使得磁带文件只能存储顺序文件。</li><li>顺序文件是所有逻辑文件当中存储效率最高的。（只需要按照顺序读和写就可以了。）</li></ul><p><strong>问题</strong>：顺序文件的增删改效率低。</p><h4 id="6-1-5-索引文件">6.1.5 索引文件</h4><ul><li><p>可变长文件不适合使用顺序文件格式存储。</p></li><li><p>索引文件是为了解决可变长文件存储而发明的一种文件格式。</p></li><li><p>索引文件需要配合索引表完成存储操作。</p></li></ul><p><strong>索引表</strong>：</p><p><img src="https://hutu.aimtao.net/mark/2020-09-13-nchlYf.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="6-2-辅存的存储空间分配">6.2 辅存的存储空间分配</h3><h4 id="6-2-1-辅存的分配方式">6.2.1 辅存的分配方式</h4><p><img src="https://hutu.aimtao.net/mark/2020-09-13-WfDxGO.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="6-2-2-连续分配">6.2.2 连续分配</h4><p>举个例子：如果程序需要六个扇区的空间，系统就分配连续六个扇区。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-13-tIqSJV.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li>顺序读取文件内存非常容易，速度快。</li><li>对存储要求高：要求有 <em>满足容量的连续存储空间</em>。</li></ul><h4 id="6-2-3-链接分配">6.2.3 链接分配</h4><ul><li>链式分配可以将文件存储在离散的盘块中。</li><li>需要 <em>额外的存储空间</em> 存储 <em>文件的盘块链接顺序</em>。</li></ul><p><strong>（1）隐式链接</strong></p><ul><li>当前盘块内存储了 <em>下一个链接指向</em>。例如：第 2 个盘块存储着 <em>下一个链接指向</em>（第 9个盘块）。</li><li>隐式分配适合顺序访问，随机访问效率低。</li></ul><p><strong>问题</strong>：可靠性差，任何一个链接出现问题，都将影响整个文件。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-13-SlU7CK.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>（2）显示链接</strong></p><blockquote><p>解决隐式链接分配的问题（可靠性差，随机访问效率低）。</p></blockquote><p>与隐式链接分配想比，显示链接分配方式，多了一个 FAT 表。（File Allocation Table）</p><p><img src="https://hutu.aimtao.net/mark/2020-09-13-DQHy5S.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>问题</strong>：</p><ul><li><p>不支持高效的直接存储。</p><ul><li>FAT 记录项较多，磁盘越大，FAT 的记录项就越多。</li><li>当在 FAT 文件系统中添加一个较大的文件，就需要检索整个 FAT 表，找到空闲的行块号。</li></ul></li><li><p>检索时，FAT 表占用较大的存储空间。（需要将整个 FAT 表加载到内存中）</p></li></ul><h4 id="6-2-4-索引分配">6.2.4 索引分配</h4><ul><li>每个文件拥有一个索引块，记录所有盘块信息。</li><li>当需要读取某一个文件时，将文件索引读取进内存即可。</li><li>索引分配方式支持直接访问盘块。</li><li>文件较大时，索引分配方式具有明显的优势。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-13-xUSjde.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="6-3-辅存的存储空间管理">6.3 辅存的存储空间管理</h3><p><img src="https://hutu.aimtao.net/mark/2020-09-13-sOG56v.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h4 id="6-3-1-空闲表">6.3.1 空闲表</h4><p><img src="https://hutu.aimtao.net/mark/2020-09-13-MfJ0Zb.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li><p>空闲盘区的分配与内存分配类似。</p></li><li><p>也是使用 <a href="#分配算法">首次适应算法、循环适应算法、最佳适应算法、快速适应算法</a>。</p></li><li><p>回收过程与内存回收类似。</p></li></ul><h4 id="6-3-2-空闲链表">6.3.2 空闲链表</h4><ul><li>把所有空闲盘区组成 <em><strong>一个</strong></em> 空闲链表</li><li>每个链表节点存储空闲盘块和空闲数目。</li></ul><p>与 <a href="#内存空闲链表">内存空闲链表</a> 类似。</p><h4 id="6-3-3-位示图">6.3.3 位示图</h4><blockquote><p>实际的辅存的存储空间管理就是使用位示图来管理的。</p></blockquote><p>横轴位磁道，纵轴为盘块，1 表示被占用、0 表示未被使用。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-13-r7py16.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>优点</strong>：</p><ul><li>位示图的维护成本低，只需要维护一个表。</li><li>位示图可以很容易的找到空闲的盘块。</li><li>位示图使用的 0/1 比特位，占用空间小。</li></ul><h4 id="6-3-4-目录管理（目录树）">6.3.4 目录管理（目录树）</h4><p>作用：使得每一个文件都有唯一的路径。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-13-RLHXmF.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="6-4-Linux-文件">6.4 Linux 文件</h3><h4 id="6-4-1-Linux-常用目录">6.4.1 Linux 常用目录</h4><table><thead><tr><th>目录</th><th>描述</th></tr></thead><tbody><tr><td>/bin</td><td>存放二进制可执行文件(ls,cat,mkdir等)，常用命令一般都在这里</td></tr><tr><td>/etc</td><td>存放系统管理和配置文件</td></tr><tr><td>/home</td><td>存放所有用户文件的根目录，是用户主目录的基点，比如用户user的主目录就是 /home/user</td></tr><tr><td>/usr</td><td>用于存放系统应用程序，比较重要的目录/usr/local 本地系统管理员软件安装目录</td></tr><tr><td>/opt</td><td>额外安装的可选应用程序包所放置的位置</td></tr><tr><td>/proc</td><td>虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息。</td></tr><tr><td>/root</td><td>超级用户（系统管理员）的主目录</td></tr><tr><td>/sbin</td><td>存放二进制可执行文件，只有root才能访问</td></tr><tr><td>/dev</td><td>用于存放设备文件</td></tr><tr><td>/mnt</td><td>系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系 统。</td></tr><tr><td>/boot</td><td>存放用于系统引导时使用的各种文件</td></tr><tr><td>/lib</td><td>存放跟文件系统中的程序运行所需要的共享库及内核模块</td></tr><tr><td>/var</td><td>用于存放运行时需要改变数据的文件</td></tr></tbody></table><h4 id="6-4-2-Linux-文件类型">6.4.2 Linux 文件类型</h4><p>其中，b 表示块设备，c 表示字符设备。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-14-3n8BUx.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="6-5-Linux-文件系统">6.5 Linux 文件系统</h3><h4 id="6-5-1-文件系统">6.5.1 文件系统</h4><ul><li><p><strong>FAT（File Allocation Table）</strong></p><ul><li>FAT16、FAT32等，微软 Dos/Windows 使用的文件系统。</li><li>用一张表来保存盘块的信息。</li></ul></li><li><p><strong>NTFS（New Technology File System）</strong></p><ul><li>WindowsNT环境的文件系统。</li><li>NTFS 对 FAT 进行了改进，取代了旧的文件系统。</li></ul></li><li><p><strong>EXT（Extended file system）</strong></p><ul><li>扩展文件系统，EXT2/3/4。</li><li>Linux 的文件系统。</li></ul></li></ul><h4 id="6-5-2-EXT文件系统">6.5.2 EXT文件系统</h4><p><img src="https://hutu.aimtao.net/mark/2020-09-14-Jn6ZYt.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li><strong>Boot Sector</strong>：启动扇区，安装开机管理程序。</li><li><strong>Block Group</strong>：块组，存储数据的实际位置。</li></ul><p>Block Group 中，</p><ul><li><p><strong>Inode table</strong></p><ul><li>Inode table：存放 Inode 的地方。</li><li>Inode 是每个文件的索引节点。（EXT文件系统管理外存的方式是索引分配）</li><li>每个文件（目录）都有一个 Inode。</li><li>Inode 存储了 <em><strong>索引节点编号</strong></em>、文件类型、文件权限、文件物理地址、文件长度、文件连接计数、文件存取时间、文件状态、访问计数、链接指针。</li><li>【<strong>特殊</strong>】文件名不是存放在 Inode 节点上的，而是存放在 <em><strong>目录的 Inode 节点上</strong></em>。<ul><li>【<strong>原因</strong>】列出目录文件的时候无需加载文件的 Inode。</li></ul></li></ul></li><li><p><strong>Inode bitmap</strong></p><ul><li>Inode 的位示图</li><li>记录已分配的 Inode 和未被分配的 Inode。<img src="https://hutu.aimtao.net/mark/2020-09-15-psoQxQ.webp-s" srcset="/img/loading.gif" lazyload alt=""></li></ul></li><li><p><strong>Data block</strong></p><ul><li>Data block 是存放文件内容的地方。</li><li>每个 block 都有唯一的编号。</li><li>文件的 block 记录在文件的 Inode 上。</li></ul></li><li><p><strong>Block bitmap</strong></p><ul><li>功能和 Inode bitmap 类似。</li><li>记录 Data block 的使用情况。</li></ul></li><li><p><strong>Superblock</strong></p><ul><li>记录整个文件系统相关信息的地方。</li><li>Block 和 Inode 的使用情况。</li><li>时间信息、控制信息等。</li><li>一般为 1024 字节。</li></ul></li></ul><h2 id="7-设备管理">7.设备管理</h2><h3 id="7-1-广义的-IO-设备">7.1 广义的 IO 设备</h3><ul><li>对 CPU 而言，凡是对 CPU 进行数据输入的都是输入设备。</li><li>对 CPU 而言，凡是对 CPU 进行数据输出的都是输出设备。</li></ul><h3 id="7-2-分类">7.2 分类</h3><p><img src="https://hutu.aimtao.net/mark/2020-09-15-fbDpHa.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><img src="https://hutu.aimtao.net/mark/2020-09-15-SXHfTJ.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><img src="https://hutu.aimtao.net/mark/2020-09-15-geeOni.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><img src="https://hutu.aimtao.net/mark/2020-09-15-kGIqVl.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="7-3-IO-设备的缓冲区">7.3 IO 设备的缓冲区</h3><blockquote><p><strong>问题</strong>：CPU 和 IO 设备的速率不匹配。</p></blockquote><ul><li>除了 <strong>存储器的体系结构</strong> 之外，缓冲区就是为了解决这个问题的。</li><li>减少 CPU 处理 IO 请求的频率。</li><li>提高 CPU 与 IO 设备的并行性。</li></ul><p><strong>举个例子</strong>：</p><p>程序需要和 IO 设备进行交互多次，有了缓冲区之后，只需要交互一次。</p><p><img src="https://hutu.aimtao.net/mark/2020-12-15-dBFJ9y.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><ul><li>专用缓冲区只适用于特定的 IO 进程。</li><li>当这样的 IO 进程比较多时，对内存的消耗也很大。</li><li>因此，操作系统划出可供多个进程使用的公共缓冲区，称为缓冲池。</li></ul><h3 id="7-4-缓冲池">7.4 缓冲池</h3><p>从缓冲池取出缓冲区分配给进程。</p><p><img src="https://hutu.aimtao.net/mark/2020-09-15-B5vwnX.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="7-5-SPOOLing-技术">7.5 SPOOLing 技术</h3><blockquote><p>虚拟设备技术</p></blockquote><ul><li>是关于慢速字符设备如何与计算机主机交换信息的一种技术。</li><li>利用 <strong>高速共享设备</strong> 将 <strong>低速独享设备</strong> 模拟为 <strong>高速的共享设备</strong>。</li><li>逻辑上，系统为每个用户都分配了一台独立的高速独享设备。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-15-Fr1FTv.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><em><strong>SPOOLing 技术把同步调用低速设备改为了异步调用。</strong></em></p><ul><li>在输入、输出之间，<em><strong>增加排队转储环节</strong></em>（输入井、输出井）。</li><li>SPOOLing 负责输入输出井与低速设备之间的调度。</li><li>逻辑上，进程直接与高速设备交互，减少进程的等待时间。</li></ul><h2 id="8-线程同步与进程同步">8.线程同步与进程同步</h2><p><img src="https://hutu.aimtao.net/mark/2020-09-15-dqFfAs.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="8-1-线程同步之互斥量">8.1 线程同步之互斥量</h3><p><strong>互斥量的原理</strong>：</p><ul><li>当一个线程正在使用临界资源（互斥量）时，其他线程不能使用。</li><li>生产者和消费者模型中，最大的问题就是，<strong>两个线程的指令交叉执行！</strong></li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-15-qHYe0W.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><p><strong>互斥量的作用</strong>：</p><ul><li>互斥量可以保证两个线程的指令先后执行。</li><li>互斥量保护了线程的原子性（原子性指：一系列操作不可被中断的特性）。</li><li>互斥量是最简单的线程同步的方法。</li><li>互斥量也称为互斥锁，处于两态之一的变量：解锁和加锁（两个状态保证了资源访问的串行）。</li><li>两个状态保证资源访问的串行。</li></ul><p><strong>互斥量的使用</strong>：</p><ul><li>操作系统直接提供了互斥量的 API。</li><li>开发者可以直接使用 API完成资源的枷锁、解锁操作。</li><li>pthread_mutex_t</li></ul><p>👉 <a href="https://github.com/AimTao/tool-by-cpp/tree/master/executable/mutex" rel="nofollow noopener" target="_blank">验证程序</a></p><h3 id="8-2-线程同步之自旋锁">8.2 线程同步之自旋锁</h3><p><strong>自旋锁的原理</strong>：</p><ul><li>自旋锁也是一种多线程同步的变量（与互斥锁相同）。</li><li>使用自旋锁的线程会 <strong>反复检查</strong> 锁变量是否可用。</li><li>自旋锁不会让出 CPU，是一种 <strong>忙等待</strong> 状态（死循环）。</li></ul><p><strong>自旋锁的作用</strong>：</p><ul><li>自旋锁避免了进程或线程上下文切换的开销（如果锁占用时间不是很长的话，使用自旋锁的代价很小）。</li><li>操作系统内存很多地方使用的是自旋锁。</li><li>自旋锁不适合在单核 CPU 中使用。</li></ul><p><strong>自旋锁的使用</strong>：</p><ul><li>pthread_spinlock_t</li></ul><p>👉 <a href="https://github.com/AimTao/tool-by-cpp/tree/master/executable/spin_lock" rel="nofollow noopener" target="_blank">验证程序</a></p><h3 id="8-3-线程同步之读写锁">8.3 线程同步之读写锁</h3><p><strong>为什么会有读写锁</strong>：</p><ul><li>适用于临界资源多读少写（比如存储历史订单的数据库）。</li><li>读取的时候并不会改变临界资源的值。</li><li>读写均会加锁，会降低性能。</li></ul><p><strong>读写锁的特点</strong>：</p><ul><li>读写锁是一种特殊的自旋锁。</li><li>允许多个读者同时访问资源以提高读性能。</li><li>对于写操作是互斥的。</li></ul><p><strong>读写锁的使用</strong>：</p><ul><li>pthread_rwlock_t</li><li>pthread_rwlock_rdlock（读锁）</li><li>pthread_rwlock_wrlock（写锁）</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-17-wBWMTf.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="8-4-线程同步之条件变量">8.4 线程同步之条件变量</h3><ul><li>条件变量是一种相对复杂的线程同步方法。</li><li>条件变量允许线程睡眠，直到满足某种条件。</li><li>当满足条件时，可以向该线程信号，通知唤醒。</li></ul><p><img src="https://hutu.aimtao.net/mark/2020-09-17-n9TNZO.webp-s" srcset="/img/loading.gif" lazyload alt=""></p><script type="text/javascript">!function(l){[].forEach.call(l.getElementsByClassName("fold"),(function(l){l.getElementsByClassName("fold-title")[0].onclick=function(){l.classList.toggle("collapsed"),l.classList.toggle("expanded")}}))}(document)</script></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Mark/" class="category-chain-item">Mark</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">#操作系统</a></div></div><div class="license-box my-3"><div class="license-title"><div>学习笔记｜操作系统</div><div>https://www.aimtao.net/operating-system/</div></div><div class="license-meta"><div class="license-meta-item license-meta-date"><div>Posted on</div><div>2019-05-31</div></div><div class="license-meta-item"><div>Licensed under</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - Non-commercial"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - Share-alike"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/bitcoin-encryption/" title="比特币中密码学的应用"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">比特币中密码学的应用</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/mystery-of-silicon-valley/" title="《硅谷之谜》｜为何硅谷 4 次转型后依旧长盛不衰"><span class="hidden-mobile">《硅谷之谜》｜为何硅谷 4 次转型后依旧长盛不衰</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments"><div id="valine"></div><style>.v[data-class=v] .veditor{background-image:url(https://hutu0.aimtao.net/foot/drinkwater.webp);background-size:contain;background-repeat:no-repeat;background-position:right;resize:none}</style><script type="text/javascript">Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/valine/1.4.18/Valine.min.js",(function(){var e=Object.assign({appId:"Lwz6D7d9XSdSYpjixPxukzhF-gzGzoHsz",appKey:"UhkN5uCsv1zxjYO6nJ7vOjpB",path:"window.location.pathname",placeholder:"本站支持评论邮件提醒功能，在上方输入邮箱，即可收到回复通知！（支持 markdown 语法）",avatar:"robohash",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!0,recordIP:!0,serverURLs:"https://valine.aimtao.net",emojiCDN:"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/",emojiMaps:{666:"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/6c/2022_666_org.png","微笑":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/e3/2018new_weixioa02_org.png","可爱":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/09/2018new_keai_org.png","太开心":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/1e/2018new_taikaixin_org.png","鼓掌":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/6e/2018new_guzhang_org.png","嘻嘻":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/33/2018new_xixi_org.png","哈哈":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/8f/2018new_haha_org.png","笑cry":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/4a/2018new_xiaoku_thumb.png","挤眼":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/43/2018new_jiyan_org.png","馋嘴":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/fa/2018new_chanzui_org.png","黑线":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/a3/2018new_heixian_org.png","汗":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/28/2018new_han_org.png","挖鼻":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/9a/2018new_wabi_thumb.png","哼":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/7c/2018new_heng_org.png","怒":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/f6/2018new_nu_org.png","委屈":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/a5/2018new_weiqu_org.png","可怜":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/96/2018new_kelian_org.png","失望":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/aa/2018new_shiwang_org.png","悲伤":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/ee/2018new_beishang_org.png","泪":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/6e/2018new_leimu_org.png","允悲":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/83/2018new_kuxiao_org.png","苦涩":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/7e/2021_bitter_org.png","害羞":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/c1/2018new_haixiu_org.png","污":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/10/2018new_wu_org.png","爱你":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/f6/2018new_aini_org.png","亲亲":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/2c/2018new_qinqin_org.png","抱一抱":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/af/2020_hug_org.png","色":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/9d/2018new_huaxin_org.png","憧憬":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/c9/2018new_chongjing_org.png","舔屏":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/3e/2018new_tianping_org.png","哇":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/3d/2022_wow_org.png","坏笑":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/4d/2018new_huaixiao_org.png","阴险":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/9e/2018new_yinxian_org.png","笑而不语":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/2d/2018new_xiaoerbuyu_org.png","偷笑":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/71/2018new_touxiao_org.png","酷":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/c4/2018new_ku_org.png","并不简单":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/aa/2018new_bingbujiandan_org.png","思考":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/30/2018new_sikao_org.png","疑问":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/b8/2018new_ningwen_org.png","费解":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/2a/2018new_wenhao_org.png","晕":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/07/2018new_yun_org.png","衰":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/a2/2018new_shuai_org.png","骷髅":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/a1/2018new_kulou_org.png","嘘":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/b0/2018new_xu_org.png","闭嘴":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/62/2018new_bizui_org.png","傻眼":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/dd/2018new_shayan_org.png","裂开":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/1b/202011_liekai_org.png","感冒":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/8c/2022_cold_org.png","吃惊":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/49/2018new_chijing_org.png","吐":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/08/2018new_tu_org.png","生病":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/3b/2018new_shengbing_org.png","拜拜":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/fd/2018new_baibai_org.png","鄙视":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/da/2018new_bishi_org.png","白眼":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/ef/2018new_landelini_org.png","左哼哼":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/43/2018new_zuohengheng_org.png","右哼哼":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/c1/2018new_youhengheng_org.png","抓狂":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/17/2018new_zhuakuang_org.png","怒骂":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/87/2018new_zhouma_org.png","打脸":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/cb/2018new_dalian_org.png","顶":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/ae/2018new_ding_org.png","互粉":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/86/2018new_hufen02_org.png","钱":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/a2/2018new_qian_org.png","哈欠":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/55/2018new_dahaqian_org.png","困":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/3c/2018new_kun_org.png","睡":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/e2/2018new_shuijiao_thumb.png","赢牛奶":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/9c/2021_yingniunai_org.png","开学季":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/72/2021_kaixueji_org.png","求饶":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/aa/moren_qiurao02_org.png","吃瓜":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/01/2018new_chigua_org.png","打call":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/39/moren_dacall02_org.png",awsl:"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/14/moren_awsl02_org.png","彩虹屁":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/4b/2022_praise_org.png","酸":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/b3/hot_wosuanle_org.png",doge:"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/a1/2018new_doge02_org.png","二哈":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/22/2018new_erha_org.png","喵喵":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/7b/2018new_miaomiao_org.png","单身狗":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/20/2021_alongdog_org.png","揣手":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/af/2022_chuaishou_org.png","举手":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/fd/2022_raisehand_org.png","抱抱":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/42/2018new_baobao_org.png","摊手":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/62/2018new_tanshou_org.png","跪了":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/75/2018new_gui_org.png","握手":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/e9/2018new_woshou_org.png","赞":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/e6/2018new_zan_org.png",good:"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/8a/2018new_good_org.png","弱":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/3d/2018new_ruo_org.png","耶":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/29/2018new_ye_org.png","拳头":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/86/2018new_quantou_org.png",ok:"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/45/2018new_ok_org.png","加油":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/9f/2018new_jiayou_org.png","作揖":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/e7/2018new_zuoyi_org.png",haha:"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/1d/2018new_hahashoushi_org.png","鲜花":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/d4/2018new_xianhua_org.png","杰瑞":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/da/2021_jerry_org.png","汤姆":"https://face.t.sinajs.cn/t4/appstyle/expression/ext/normal/31/2021_tom_org.png","tvgif-白眼":"https://i0.hdslb.com/bfs/emote/48f75163437445665a9be80bb316e4cb252c5415.gif","tvgif-doge":"https://i0.hdslb.com/bfs/emote/302d6c88c63ed162c81a49cafe7ed2709e6fb955.gif","tvgif-坏笑":"https://i0.hdslb.com/bfs/emote/5d2572efd09aab5dde9e2a198bb3f9ac1e2a982e.gif","tvgif-难过":"https://i0.hdslb.com/bfs/emote/9c6b41008a67755410f712334c64313df5f91b3f.gif","tvgif-生气":"https://i0.hdslb.com/bfs/emote/1902a5a2df5b5c931d88c12f0feb264b1e109d0d.gif","tvgif-委屈":"https://i0.hdslb.com/bfs/emote/af5a5853edb43a8178a8cb5df707fa5e88143699.gif","tvgif-斜眼笑":"https://i0.hdslb.com/bfs/emote/c66568b471192ca1f62f6ed4384dc1b283ab7508.gif","tvgif-呆":"https://i0.hdslb.com/bfs/emote/d3fa91e4db9215eb1e20ab9da44f1214aa4bda7b.gif","tvgif-发怒":"https://i0.hdslb.com/bfs/emote/3959eb81b952e4fa8d269d98f9e3639172d84073.gif","tvgif-惊吓":"https://i0.hdslb.com/bfs/emote/13549060757fcd92b11d0657d9b3b6038f97abb6.gif","tvgif-呕吐":"https://i0.hdslb.com/bfs/emote/db58e9442aae26694af18cc1683607cca3a16763.gif","tvgif-思考":"https://i0.hdslb.com/bfs/emote/b63f9146bfd985af014f8d6d4bdb498805be48f9.gif","tvgif-微笑":"https://i0.hdslb.com/bfs/emote/b98656855d782f61cb8edc7f7fca6563ecafff7e.gif","tvgif-疑问":"https://i0.hdslb.com/bfs/emote/fce1b1a0f3b0e39a2dc16a18508dba7b91e929f4.gif","tvgif-大哭":"https://i0.hdslb.com/bfs/emote/cba61f05f3039b02a7ffc0dfcd9d7995df9fdd74.gif","tvgif-鼓掌":"https://i0.hdslb.com/bfs/emote/be106e6b265883a9f28fbe10f7b765701e2618d4.gif","tvgif-抠鼻":"https://i0.hdslb.com/bfs/emote/696d9f93e722144dc2a78aeffc569418fdf3d565.gif","tvgif-亲亲":"https://i0.hdslb.com/bfs/emote/3534ea44ab74bd20352b88c245a06c4b4c46d271.gif","tvgif-调皮":"https://i0.hdslb.com/bfs/emote/fcd967395fd14e4dd5829fa7e8a967ce23205e52.gif","tvgif-笑哭":"https://i0.hdslb.com/bfs/emote/1c2fd1e8c9dde12812f86e5d4cbddd8993d98082.gif","tvgif-晕":"https://i0.hdslb.com/bfs/emote/030040ec5c9ddc9e3d067658c4139e7314ab42f8.gif","tvgif-点赞":"https://i0.hdslb.com/bfs/emote/30ecff401245fb56bcc1cf588d1809ac1ab1607c.gif","tvgif-害羞":"https://i0.hdslb.com/bfs/emote/411a3e459e8580f5bfd9f639a408247c4b509935.gif","tvgif-睡着":"https://i0.hdslb.com/bfs/emote/3c8b5e293261287a6203597e29b3de07df4d18c6.gif","tvgif-色":"https://i0.hdslb.com/bfs/emote/a0c6d99ab0ab63b8648f5283ff72cec04b604828.gif","tvgif-吐血":"https://i0.hdslb.com/bfs/emote/e17e4539e169d14a3389ff147afea760cebe5de5.gif","tvgif-无奈":"https://i0.hdslb.com/bfs/emote/eb4cb5f07cfd177c7e6a7914316717e56d9cc1d0.gif","tvgif-再见":"https://i0.hdslb.com/bfs/emote/344f61609ecce2008520dc8a977b6169215748a9.gif","tvgif-流汗":"https://i0.hdslb.com/bfs/emote/390bccec65eaff536bd5bb2a0c5b8b0bdea47334.gif","tvgif-偷笑":"https://i0.hdslb.com/bfs/emote/7f11e6f7f63e79112b833bd41fa13a83d7cd8474.gif","tvgif-抓狂":"https://i0.hdslb.com/bfs/emote/a476b93ecd8e94ac3257323fd822f91cef212de2.gif","tvgif-黑人问号":"https://i0.hdslb.com/bfs/emote/b609adf664be33224a9923262031165ae3e34cd2.gif","tvgif-困":"https://i0.hdslb.com/bfs/emote/91c2bf34ecf842d7016c01d841db3d4074bd281f.gif","tvgif-打脸":"https://i0.hdslb.com/bfs/emote/b0fad4856e59c1240e448437da3287bb5ce547e5.gif","tvgif-闭嘴":"https://i0.hdslb.com/bfs/emote/a3fc5388b09e945be3f18fe23bfed5874a0285b7.gif","tvgif-鄙视":"https://i0.hdslb.com/bfs/emote/293b5d459e6264ecf314d20937a936fa672ccd1e.gif","tvgif-腼腆":"https://i0.hdslb.com/bfs/emote/30984e8264324f901d19bea85dada7103b695534.gif","tvgif-馋":"https://i0.hdslb.com/bfs/emote/2525c5703c594e5f0752f68db8948773caebde47.gif","tvgif-可爱":"https://i0.hdslb.com/bfs/emote/f92d20f76258bc5f33fc9d7c5e2a1d41fef19a7c.gif","tvgif-发财":"https://i0.hdslb.com/bfs/emote/76131e52c9b033681b4c896c6024d29ef7ec7ec2.gif","tvgif-生病":"https://i0.hdslb.com/bfs/emote/beb94829fe04f1a41bd6ca611e1f6ca9ca169afa.gif","tvgif-流鼻血":"https://i0.hdslb.com/bfs/emote/8ef473f74a849420da712487b2f56ecca1f695f5.gif","tvgif-尴尬":"https://i0.hdslb.com/bfs/emote/e0b84ef5ee3e5b8978e584c7c5a6550c51d15f84.gif","tvgif-大佬":"https://i0.hdslb.com/bfs/emote/14ca0c05382b8741940942b2430b7a8d55c02f7e.gif","暹罗猫小豆泥-抱大腿":"https://i0.hdslb.com/bfs/emote/1e309b348e969e7ff1c7d873352799a2005494d5.png","暹罗猫小豆泥-不要":"https://i0.hdslb.com/bfs/emote/00d5e138feb370186c4e473061b21b42f8a3ea36.png","暹罗猫小豆泥-呆滞":"https://i0.hdslb.com/bfs/emote/b6ec6210f8c7095f4a14ccf8a6ec1b60fb1aa416.png","暹罗猫小豆泥-单纯":"https://i0.hdslb.com/bfs/emote/e5cdb0d44f35f545d37cbc95ca09cdb9f79ebf48.png","暹罗猫小豆泥-好耶":"https://i0.hdslb.com/bfs/emote/5fc0be80c750a057d1c068a9a3c65c7b09a49e02.png","暹罗猫小豆泥-惊讶":"https://i0.hdslb.com/bfs/emote/d6024fd52d7e66241062c045559974e2a4c6e87f.png","暹罗猫小豆泥-哭":"https://i0.hdslb.com/bfs/emote/9153d549e425cc02eb911695fff29cb59b338da0.png","暹罗猫小豆泥-来了":"https://i0.hdslb.com/bfs/emote/d5d12b9d885346de164f30d41a10f235872aaefa.png","暹罗猫小豆泥-呸":"https://i0.hdslb.com/bfs/emote/a7f7d5a13c8d1c1ff116e7362108fb49045b4b72.png","暹罗猫小豆泥-探头":"https://i0.hdslb.com/bfs/emote/4741a1d527c52365850368b2f480d5818b23cb8f.png","暹罗猫小豆泥-舔":"https://i0.hdslb.com/bfs/emote/d071edebf8d3fbad73d773e9049eee2a0c28f1d5.png","暹罗猫小豆泥-投币":"https://i0.hdslb.com/bfs/emote/77b10ddaf24b4547e712ba8ae8f8e51ca8c38bb1.png","暹罗猫小豆泥-苦鲁西":"https://i0.hdslb.com/bfs/emote/ad3b14a2a5cf6680468222581a9964577eaca3d3.png","暹罗猫小豆泥-再见":"https://i0.hdslb.com/bfs/emote/e4c72ecf403858750b881030d650769e79017561.png","暹罗猫小豆泥-震惊":"https://i0.hdslb.com/bfs/emote/7caf9631dfb93071a843e308e5382799494d3a71.png"},enableQQ:!1},{el:"#valine",path:window.location.pathname});new Valine(e),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var e="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(e),Fluid.plugins.fancyBox(e)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js",(function(){mermaid.initialize({theme:"default"})}))</script><button id="floating-toc-button" class="floating-toc-button"><i class="iconfont icon-list"></i></button><div id="floating-toc" class="floating-toc"><div class="floating-toc-header"><i class="iconfont icon-list"></i></div><div class="floating-toc-body"><ul class="floating-toc-list" id="floating-toc-list"></ul></div></div><script>document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("floating-toc-button"),e=document.getElementById("floating-toc"),n=document.getElementById("floating-toc-list"),o=!1,d=0,i=0;t.addEventListener("mousedown",(function(e){o=!0,d=e.clientX-t.offsetLeft,i=e.clientY-t.offsetTop})),document.addEventListener("mousemove",(function(e){o&&(t.style.left=e.clientX-d+"px",t.style.top=e.clientY-i+"px")})),document.addEventListener("mouseup",(function(){o=!1})),t.addEventListener("touchstart",(function(e){o=!0,d=e.touches[0].clientX-t.offsetLeft,i=e.touches[0].clientY-t.offsetTop})),document.addEventListener("touchmove",(function(e){o&&(t.style.left=e.touches[0].clientX-d+"px",t.style.top=e.touches[0].clientY-i+"px")})),document.addEventListener("touchend",(function(){o=!1})),t.addEventListener("click",(function(){e.classList.toggle("active")})),document.querySelectorAll(".markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6").forEach((function(t){var o=parseInt(t.tagName.charAt(1)),d=document.createElement("li"),i=document.createElement("a");i.classList.add("floating-toc-link"),i.textContent=t.textContent,i.setAttribute("href","#"+t.getAttribute("id")),d.classList.add("floating-toc-list-item"),d.classList.add("level-"+o),d.appendChild(i),n.appendChild(d),i.addEventListener("click",(function(n){n.preventDefault();var o=t.getAttribute("id"),d=document.getElementById(o),i=document.getElementsByClassName("header-inner")[0];if(d&&i){var c=window.pageYOffset,a=d.offsetTop+i.offsetHeight-c,s=null;window.requestAnimationFrame((function t(e){s||(s=e);var n,o=e-s,d=Math.min(o/1e3,1),i=(n=d)<.5?2*n*n:(4-2*n)*n-1;window.scrollTo(0,c+a*i),o<1e3&&window.requestAnimationFrame(t)}))}e.classList.remove("active")}))}))}))</script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="statistics"><span id="leancloud-site-pv-container" style="display:none"><i class="iconfont iconPV"></i> <span id="leancloud-site-pv"></span> </span><span id="leancloud-site-uv-container" style="display:none"><i class="iconfont iconUV"></i> <span id="leancloud-site-uv"></span></span></div><div class="beian"><span><i class="iconfont iconICP-13"></i> <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">鄂 ICP 备 20000502 号</a></span></div><div class="footer-content"><a href="https://www.aimtao.net/categories/Mark/" rel="nofollow noopener"><span id="aimtao">© 2025 AimTao </span></a><i class="iconfont icon-love"></i> <span id="timeDate">loading...</span> <span id="times">loading...</span><script>var now=new Date;function createtime(){var n=new Date("11/28/2018 15:28:05");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="&nbsp"+dnum+"&nbsp天",document.getElementById("times").innerHTML=hnum+"&nbsp小时&nbsp"+mnum+"&nbsp分&nbsp"+snum+"&nbsp秒"}setInterval("createtime()",250)</script></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script defer>if(!Fluid.ctx.dnt){var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?07fe5d228ae82eadee00480515f9d64b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script>!function(){var e=CONFIG.code_language.enable&&CONFIG.code_language.default,a=CONFIG.copy_btn;if(e||a){var i="";i+='<div class="code-widget">',i+="LANG",i+="</div>",jQuery(".markdown-body pre").each((function(){var n=jQuery(this);if(!(n.find("code.mermaid").length>0||n.find("span.line").length>0)){var t,c="";e&&(c=CONFIG.code_language.default,n[0].children.length>0&&n[0].children[0].classList.length>=2&&n.children().hasClass("hljs")?c=n[0].children[0].classList[1]:n[0].getAttribute("data-language")?c=n[0].getAttribute("data-language"):n.parent().hasClass("sourceCode")&&n[0].children.length>0&&n[0].children[0].classList.length>=2?(c=n[0].children[0].classList[1],n.parent().addClass("code-wrapper")):n.parent().hasClass("markdown-body")&&0===n[0].classList.length&&n.wrap('<div class="code-wrapper"></div>'),c=c.toUpperCase().replace("NONE",CONFIG.code_language.default)),n.append(i.replace("LANG",c).replace('code-widget">',(t=n[0],(Fluid.utils.getBackgroundLightness(t)>=0?"code-widget-light":"code-widget-dark")+(a?' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>':' code-widget">')))),a&&Fluid.utils.createScript("https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js",(function(){new window.ClipboardJS(".copy-btn",{target:function(e){for(var a=e.parentNode.childNodes,i=0;i<a.length;i++)if("CODE"===a[i].tagName)return a[i]}}).on("success",(function(e){e.clearSelection(),e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-copy","icon-success"),setTimeout((function(){e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-success","icon-copy")}),2e3)}))}))}}))}}()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="/js/leancloud.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>